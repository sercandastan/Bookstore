@using Bookstore.Areas.AdminPanel.ViewModels.Book_VM
@model CreateBook_VM

@{
	ViewData["Title"] = "Kitap Ekle";
}


<div class="container mt-4">
	<h2 class="mb-4 text-primary">
		<i class="bi bi-journal-plus me-2"></i>Yeni Kitap Ekle
	</h2>


	<form asp-area="AdminPanel" asp-controller="Book" asp-action="Create" method="post" enctype="multipart/form-data" class="bg-light p-4 rounded shadow-sm">

		<div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

		<div class="row g-3">
			<!-- Kitap Adı -->
			<div class="col-md-6">
				<label asp-for="Title" class="form-label">Kitap Adı</label>
				<input asp-for="Title" class="form-control" placeholder="Kitap adını giriniz (örnek: Simyacı)" />
				<span class="form-text text-muted">Kitap adı en fazla 50 karakter olabilir.</span>
				<span asp-validation-for="Title" class="text-danger small"></span>
			</div>

			<!-- Fiyat -->
			<div class="col-md-6">
				<label asp-for="Price" class="form-label">Fiyat (₺)</label>
				<input asp-for="Price" class="form-control" type="number" step="0.01" placeholder="Örnek: 59.90" min="0.01" />
				<span class="form-text text-muted">Ondalık ayırıcı olarak nokta (.) kullanın.</span>
				<span asp-validation-for="Price" class="text-danger small"></span>
			</div>

			<!-- Yayın Yılı -->
			<div class="col-md-6">
				<label asp-for="PublicationYear" class="form-label">Yayın Yılı</label>
				<input asp-for="PublicationYear" class="form-control" type="number" placeholder="Örnek: 2023" min="1500" max="2100" />
				<span class="form-text text-muted">Geçerli bir yıl giriniz. (1500-2100)</span>
				<span asp-validation-for="PublicationYear" class="text-danger small"></span>
			</div>

			<!-- Baskı Sayısı -->
			<div class="col-md-6">
				<label asp-for="EditionNumber" class="form-label">Baskı Sayısı</label>
				<input asp-for="EditionNumber" class="form-control" type="number" placeholder="Örnek: 3" min="1" max="1000" />
				<span class="form-text text-muted">En az 1, en fazla 1000 olabilir.</span>
				<span asp-validation-for="EditionNumber" class="text-danger small"></span>
			</div>

			<!-- Kapak Yazısı -->
			<div class="col-12">
				<label asp-for="CoverText" class="form-label">Kapak Yazısı</label>
				<textarea asp-for="CoverText" class="form-control" rows="3" placeholder="Arka kapakta görünecek tanıtım yazısı..."></textarea>
				<span class="form-text text-muted">En fazla 256 karakter olabilir.</span>
				<span asp-validation-for="CoverText" class="text-danger small"></span>
			</div>

			<!-- Kapak Görseli -->
			<div class="col-12">
				<label asp-for="CoverImage" class="form-label">Kapak Görseli</label>
				<input asp-for="CoverImage" type="file" class="form-control" />
				<span class="form-text text-muted">Kapak görseli seçilmezse varsayılan görsel atanır.</span>
				<span asp-validation-for="CoverImage" class="text-danger small"></span>
			</div>

			<!-- Yayınevi -->
			<div class="col-md-5">
				<label asp-for="PublisherId" class="form-label">Yayınevi</label>
				<div class="d-flex gap-2 align-items-start">
					<button type="button" class="btn btn-outline-secondary mt-0"
							data-bs-toggle="modal" data-bs-target="#addPublisherModal"
							title="Yeni Yayınevi Ekle">
						<i class="bi bi-plus-circle"></i>
					</button>
					<select asp-for="PublisherId" asp-items="Model.Publishers" class="form-select select2 w-100">
						<option value="" disabled selected hidden>Yayınevi Seçiniz</option>
					</select>



				</div>
				<div class="form-text">Listede yoksa ekleyebilirsiniz.</div>
				<span asp-validation-for="PublisherId" class="text-danger small"></span>
			</div>

			<!-- Kategori -->
			<div class="col-md-5">
				<label asp-for="CategoryId" class="form-label">Kategori</label>
				<div class="d-flex gap-2 align-items-start">
					<button type="button" class="btn btn-outline-secondary mt-0"
							data-bs-toggle="modal" data-bs-target="#addCategoryModal"
							title="Yeni Kategori Ekle">
						<i class="bi bi-plus-circle"></i>
					</button>
					<select asp-for="CategoryId" asp-items="Model.Categories" class="form-select select2">
						<option value="" disabled selected hidden>Kategori Seçiniz</option>
					</select>

				</div>
				<span class="form-text text-muted">Listede yoksa hemen ekleyin.</span>
				<span asp-validation-for="CategoryId" class="text-danger small"></span>
			</div>

			<!-- Yazarlar -->
			<div class="col-md-5">
				<label asp-for="AuthorIds" class="form-label">Yazar(lar)</label>
				<div class="d-flex gap-2 align-items-start">
					<button type="button" class="btn btn-outline-secondary mt-0"
							data-bs-toggle="modal" data-bs-target="#addAuthorModal"
							title="Yeni Yazar Ekle">
						<i class="bi bi-plus-circle"></i>
					</button>
					<select asp-for="AuthorIds" asp-items="Model.Authors" class="form-select select2" multiple>
					</select>

				</div>
				<span class="form-text text-muted">CTRL (veya CMD) ile çoklu seçim yapabilirsin.</span>
				<span asp-validation-for="AuthorIds" class="text-danger small"></span>
			</div>
		</div>


		<!-- Butonlar -->
		<div class="mt-4 d-flex gap-2">
			<button type="submit" class="btn btn-primary">
				<i class="bi bi-save me-1"></i> Kaydet
			</button>
			<a asp-action="Index" class="btn btn-secondary">
				<i class="bi bi-arrow-left-circle me-1"></i> İptal
			</a>
		</div>
	</form>
</div>

<!-- Modal: Publisher -->
<div class="modal fade" id="addPublisherModal" tabindex="-1" aria-labelledby="addPublisherLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			
			<form id="publisherModalForm" method="post">
				<div class="modal-header">
					<h5 class="modal-title">Yeni Yayınevi Ekle</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<input name="PublisherName" class="form-control" placeholder="Yayınevi Adı" required />
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Kaydet</button>
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
				</div>
			</form>
		</div>
	</div>
</div>



<!-- Modal: Category -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="categoryModalForm">
				<div class="modal-header">
					<h5 class="modal-title">Yeni Kategori Ekle</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<input name="CategoryName" class="form-control" placeholder="Kategori Adı" required />
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Kaydet</button>
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
				</div>
			</form>
		</div>
	</div>
</div>


<!-- Modal: Author -->
<div class="modal fade" id="addAuthorModal" tabindex="-1" aria-labelledby="addAuthorLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="authorModalForm" method="post" asp-area="AdminPanel" asp-controller="Author" asp-action="CreateAjax">
				<div class="modal-header">
					<h5 class="modal-title">Yeni Yazar Ekle</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<div class="mb-2">
						<label for="FullName" class="form-label">Yazar Adı</label>
						<input name="FullName" class="form-control" placeholder="Yazar Adı (örn: Orhan Pamuk)" required />
					</div>
					<div class="mb-2">
						<label for="BirthYear" class="form-label">Doğum Yılı</label>
						<input name="BirthYear" class="form-control" placeholder="Örn: 1980" />
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success">Kaydet</button>
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
				</div>
			</form>
		</div>
	</div>
</div>
>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
		<script src="~/js/admin/category/category-modal.js" asp-append-version="true"></script>
		<script src="~/js/admin/author/author-modal.js" asp-append-version="true"></script>
		<script src="~/js/admin/publisher/publisher-modal.js" asp-append-version="true"></script>

	}

	<!-- Select2 -->
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
	
	<script>
		$(document).ready(function () {
			$('.select2').select2({
				placeholder: 'Seçiniz',
				width: '100%',
				allowClear: true
			});

			$('.modal').on('hidden.bs.modal', function () {
				$(this).find('input').val('');
			});
		});
	</script>

}
